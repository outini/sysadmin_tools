parallel_runner
===============

A bash runner to execute code on remote hosts.
Several capabilities, used to replace the use of fabric in some conditions.

Some cleaning is still to be done, but this script is functionnal.
It involve the use of a specific file to store hosts informations.

It requires bash on running host.

Usage: parallelrunner.sh [options] <script>
    --hosts host,host,...    specify hosts by IP or name
    --roles role,role,...    specify roles from hostlist to select hosts
    --ipmatch match          specify matches against hostlist's IPs
                             matches could be for example: ^10\.42\.
    --idmatch match          specify matches against hostlist's IDs
                             matches could be for example: ^infra\.mutu[0-2]
    --hostlist file          specify local hostlist file to use
    --fork num               specify how many hosts are parrallelized
                             default is: $DEFAULT_N_FORK
    --shell shell            specify remote shell used to run script
                             default is: $DEFAULT_SHELL
    --store path             the store directory where hosts output files are
                             created. default is generated by 'mktemp -d'
    --sudo                   use sudo to run as root on remote host
    --batch                  proceed in auto mode, supress output
    <script>                 specify local script path to run on remote hosts
                             if "-" is used, script is read from stdin

When running script on remote hosts, the host's number and host's infos are
passed via environment variable: HOST_NUMBER HOST_INFOS

Use of --hosts will deactivate parsing of hostlist and use of options:
    --roles
    --ipmatch
    --idmatch
    --hostlist

If no --hosts, --roles, --idmatch or --ipmatch are used, the entire hostlist
is parsed and all found hosts are processed.

hostlist format should be respected:
    <hostname>:<hostip>:<role>:<ID>:<location>
    host:10.1.1.1:mysql:cli.mysql-1:vm.xenid.dc.hosting.corp.com

Take care of memory consumption, matching hosts are stored in memory !
